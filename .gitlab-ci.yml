stages:
  - build
  - test

variables:
  GIT_SUBMODULE_STRATEGY: recursive

before_script:
  image: python:3.9
  script:
    - pip install hatch hatch-vcs

build_tag:
  stage: build
  script:
    - hatch build
    - echo "my-arithmetic-$USER deployment on stable servers"
    - ls -l dist/
  only:
    - tags

build_develop:
  stage: build
  script:
    - hatch build
    - echo "my-arithmetic-$USER deployment on develop servers"
    - ls -l dist/

test:
  stage: test
  image: python:3.9
  before_script:
    - pip install hatch
    - hatch env create
  script:
    - hatch run test